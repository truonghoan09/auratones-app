/* =======================
   src/styles/_mixins.scss
   ======================= */

/* --- Breakpoints (px) --- */
$bp-lg-collapse: 1120; // ẩn/hamburger sớm để tránh tràn
$bp-tablet:      900;  // tablet và nhỏ hơn
$bp-mobile:      648;  // mobile nhỏ
$bp-tiny:        380;  // rất nhỏ
$bp-micro:       294;  // cực hẹp

/* --- Media helpers --- */
@mixin up($px)         { @media (min-width: #{$px}px) { @content; } }
@mixin down($px)       { @media (max-width: #{$px}px) { @content; } }
@mixin between($a, $b) { @media (min-width:#{$a}px) and (max-width:#{$b}px) { @content; } }

/* --- Fluid helpers --- */
/* clamp-based size, dùng cho text/spacing/icon */
@function fluid($min, $vw, $max) {
  @return clamp(#{$min}, #{$vw}, #{$max});
}

/* khoảng cách dọc linh hoạt theo viewport */
@mixin fluid-space-y($min, $vw, $max) {
  padding-block: fluid($min, $vw, $max);
}

/* --- Safe-area helpers (iOS notch) --- */
@mixin safe-padding($t: 14px, $r: 14px, $b: 14px, $l: 14px) {
  padding:
    #{$t}
    max(#{$r}, env(safe-area-inset-right))
    #{$b}
    max(#{$l}, env(safe-area-inset-left));
}

/* --- Container helpers --- */
/* vùng nội dung chống tràn ngang, dùng cho page wrapper */
@mixin container-fluid($px: 16px, $px-mobile: 12px) {
  max-width: 100vw;
  box-sizing: border-box;
  overflow-x: clip;
  padding-inline: #{$px};
  @include down($bp-mobile) { padding-inline: #{$px-mobile}; }
}

/* --- Drawer pattern (panel + scrim) --- */
@mixin drawer-panel() {
  position: absolute;
  top: 0; left: 0;
  width: min(420px, 100svw);
  max-width: 100svw;
  height: 100dvh;
  max-height: 100dvh;
  overflow: auto;
  overscroll-behavior: contain;
  transform: translateX(-100%);
  transition: transform .22s ease;
  will-change: transform;
  box-sizing: border-box;
}

@mixin drawer-scrim() {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.45);
  opacity: 0;
  transition: opacity .2s ease;
  pointer-events: none;
}

/* --- Flex helpers --- */
@mixin flex-center {
  display: flex;
  justify-content: center;
  align-items: center;
}

/* --- Button base (theme-aware) --- */
@mixin button-styles {
  padding: var(--spacing-sm) var(--spacing-md);
  border: none;
  border-radius: var(--border-radius-sm);
  font-size: 1rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color .3s ease, color .3s ease, filter .2s ease;

  &:hover { filter: brightness(1.06); }
}

/* --- Focus ring dùng chung --- */
@mixin focus-ring($color-var: --accent-color-rgb, $alpha: 0.18) {
  outline: none;
  border-color: var(--accent-color);
  box-shadow: 0 0 0 0.1875rem rgba(var(#{$color-var}), $alpha); /* ~3px */
}

/* --- Trạng thái invalid cho control --- */
@mixin control-invalid($danger-var: --danger-color, $danger-rgb: --danger-color-rgb) {
  border-color: var(#{$danger-var}, #f44336) !important;
  background-color: color-mix(in srgb, var(#{$danger-var}, #f44336) 6%, transparent);

  &:focus {
    box-shadow: 0 0 0 0.1875rem color-mix(in srgb, var(#{$danger-var}, #f44336) 30%, transparent);
  }
}

/* --- Select base (appearance reset + caret SVG + fluid) ---
   $h:    chiều cao control
   $minw: min-inline-size
   $pr:   padding-right chừa caret
   $pl:   padding-left
*/
@mixin select-base($h: 1.875rem, $minw: 6.5rem, $pr: 2rem, $pl: 0.75rem) {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  inline-size: auto;
  min-inline-size: $minw;
  max-inline-size: 100%;
  block-size: $h;
  padding: 0 $pr 0 $pl;

  border-radius: 0.5rem;
  border: 0.0625rem solid color-mix(in srgb, var(--text-color) 20%, transparent);
  background:
    var(--card-background)
    url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='gray'>\
<path d='M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 0 1 1.08 1.04l-4.25 4.25a.75.75 0 0 1-1.06 0L5.21 8.27a.75.75 0 0 1 .02-1.06z'/>\
</svg>") no-repeat right 0.5rem center;
  background-size: 1rem auto;

  color: var(--text-color);
  font: inherit;
  font-weight: 700;
  line-height: 1;

  transition: border-color 120ms ease, box-shadow 120ms ease, background-color 120ms ease;

  &:hover  { border-color: color-mix(in srgb, var(--text-color) 40%, transparent); }
  &:focus  { @include focus-ring(); }
  &:disabled {
    opacity: .6;
    cursor: not-allowed;
    background-color: color-mix(in srgb, var(--card-background) 90%, var(--background-color) 10%);
  }

  &::-ms-expand { display: none; }
}

/* --- Utility: ẩn phần tử khỏi layout nhưng vẫn đọc được bởi screen reader --- */
@mixin visually-hidden {
  position: absolute !important;
  inline-size: 1px !important;
  block-size: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0 0 0 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}
